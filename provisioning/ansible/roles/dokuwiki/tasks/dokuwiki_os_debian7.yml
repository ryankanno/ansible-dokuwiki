---
  - name: dokuwiki | dokuwiki_os_debian7.yml | create dokuwiki group
    group: name=dokuwiki system=yes state=present
    tags: dokuwiki

  - name: dokuwiki | dokuwiki_os_debian7.yml | create dokuwiki user
    user:
      name: dokuwiki
      group: dokuwiki
      createhome: yes
      shell: /bin/false
      system: no
      state: present
    tags: dokuwiki

  - name: dokuwiki | dokuwiki_os_debian7.yml | ensure dokuwiki downloads directory exists
    file: path=/home/dokuwiki/apps/dokuwiki/downloads state=directory owner=dokuwiki group=dokuwiki

  - name: dokuwiki | dokuwiki_os_debian7.yml | ensure dokuwiki src directory exists
    file: path=/home/dokuwiki/apps/dokuwiki/src state=directory owner=dokuwiki group=dokuwiki

  - name: dokuwiki | dokuwiki_os_debian7.yml | download dokuwiki
    get_url:
      url: "http://download.dokuwiki.org/src/dokuwiki/dokuwiki-{{ dokuwiki.version }}.tgz"
      dest: "/home/dokuwiki/apps/dokuwiki/downloads/"
    remote_user: dokuwiki
    register: new_dokuwiki_version
    tags: dokuwiki

  - name: dokuwiki | dokuwiki_os_debian7.yml | unpack dokuwiki source
    unarchive:
      src: "/home/dokuwiki/apps/dokuwiki/downloads/dokuwiki-{{ dokuwiki.version }}.tgz"
      dest: '/home/dokuwiki/apps/dokuwiki/src'
      copy: no
    remote_user: dokuwiki
    when: new_dokuwiki_version|changed
    tags: dokuwiki

  - name: dokuwiki | dokuwiki_os_debian7.yml | ensure www dir exists
    file: path=/var/www state=directory owner=www-data group=www-data
    tags: dokuwiki

  - name: dokuwiki | dokuwiki_os_debian7.yml | ensure dokuwiki www symlink exists
    file: src="/home/dokuwiki/apps/dokuwiki/src/dokuwiki-{{ dokuwiki.version }}" dest=/var/www/dokuwiki state=link owner=dokuwiki group=www-data
    tags: dokuwiki

  - name: dokuwiki | dokuwiki_os_debian7.yml | ensure dokuwiki conf directory is writable
    file: path=/var/www/dokuwiki/conf state=directory owner=dokuwiki group=www-data mode=0775 recurse=yes
    tags: dokuwiki

  - name: dokuwiki | dokuwiki_os_debian7.yml | ensure dokuwiki data directory is writable
    file: path=/var/www/dokuwiki/data state=directory owner=dokuwiki group=www-data mode=0775 recurse=yes
    tags: dokuwiki
